{% extends "base.html" %}
{% block title %}Shop CBD | RetailCurbside{% endblock %}
{% block content %}
<section class="mb-8">
    <div class="bg-emerald-700 text-white rounded-lg p-6 flex flex-col md:flex-row md:items-center md:justify-between gap-4">
        <div>
            <h1 class="text-3xl font-bold mb-2">Curbside CBD Ordering</h1>
            <p>Reserve your favorite Sunmed products and pick them up curbside.</p>
        </div>
        <form method="get" class="flex gap-2">
            <input type="text" name="q" value="{{ query }}" class="border rounded px-3 py-2 text-slate-800" placeholder="Search products...">
            <button class="bg-white text-emerald-700 font-semibold px-4 py-2 rounded" type="submit">Search</button>
        </form>
    </div>
</section>
<section class="mb-6 flex gap-2 flex-wrap items-center">
    <a href="{% url 'catalog' %}" class="px-3 py-1 rounded-full text-sm {% if not active_category %}bg-emerald-600 text-white{% else %}bg-white border{% endif %}">All</a>
    {% for category in categories %}
        <a href="|category={{ category.slug }}" class="px-3 py-1 rounded-full text-sm {% if category.slug == active_category %}bg-emerald-600 text-white{% else %}bg-white border{% endif %}">{{ category.name }}</a>
    {% endfor %}
</section>
<section>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {% for product in products %}
            <div class="bg-white rounded-lg shadow p-4 flex flex-col">
                <div class="flex-1">
                    <p class="text-xs uppercase text-slate-400">{{ product.category.name }}</p>
                    <h2 class="text-xl font-semibold mb-2"><a href="{{ product.get_absolute_url }}">{{ product.name }}</a></h2>
                    <p class="text-slate-600 text-sm mb-3">{{ product.description|truncatewords:24 }}</p>
                    <p class="text-lg font-bold text-emerald-700">${{ product.price }}</p>
                </div>
                <form method="post" action="{% url 'cart_add' product.id %}" hx-post="{% url 'cart_add' product.id %}" hx-target="#cart-indicator" hx-swap="outerHTML" class="mt-4">
                    {% csrf_token %}
                    <button class="w-full bg-emerald-600 text-white px-4 py-2 rounded disabled:opacity-50" {% if not product.in_stock %}disabled{% endif %}>Add to Cart</button>
                </form>
            </div>
        {% empty %}
            <p>No products available.</p>
        {% endfor %}
    </div>
</section>
{% endblock %}
